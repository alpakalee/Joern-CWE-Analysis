# CWE-134: 비제어 포맷 문자열 (Uncontrolled Format String) - Joern 쿼리 문제점

## 📌 개요  
CWE-134는 **사용자 입력값을 검증 없이 포맷 문자열로 사용하여, 프로그램 동작을 조작할 수 있는 취약점**입니다.  
이를 악용하면 공격자가 **메모리 덤프 유출, 임의 코드 실행, 시스템 크래시** 등을 유발할 수 있습니다.

## 🛠 주요 원인  
- `printf` 및 `wprintf` 같은 가변인자 함수 사용 시 입력값 검증 부족  
- 첫 번째 인자가 하드코딩된 문자열이 아닌 경우, 포맷 문자열 삽입 공격 발생 가능  

## 🕵️‍♂️ Joern 쿼리 문제점  
현재 Joern 쿼리는 **모든 `printf` 및 `wprintf` 호출을 분석하여, 첫 번째 인자가 리터럴 문자열이 아닌 경우를 탐지**합니다.  
그러나 이 방식은 **GoodG2B(Good Source to Bad Sink) 코드까지 탐지하는 문제가 발생**할 수 있습니다.

### 🔹 문제점 정리  
- `wprintf(data);` 같은 코드가 탐지되지만, **data가 안전한 값으로 설정된 경우에도 탐지됨**  
- 실제 취약한 `BadSink` (`wprintf(data);`에서 `data`가 사용자 입력일 경우)와  
  **안전한 `GoodG2B` (`data`가 고정된 문자열인 경우)가 구별되지 않음**  
- 쿼리에서 **`data`의 출처(사용자 입력인지 하드코딩된 값인지)를 분석하는 로직이 부족**  

## ✅ 개선 방안  
- **변수 `data`가 사용자 입력인지 하드코딩된 값인지 분석하는 로직 추가**  
- Joern 쿼리에서 **`data`의 정의 위치를 추적하여, `wcscpy(data, L"fixedstringtest")` 같은 경우 제외**  
- `cpg.identifier("data")`를 통해 **변수의 흐름을 분석하고, 사용자 입력인지 판별하는 필터 추가**  

---
